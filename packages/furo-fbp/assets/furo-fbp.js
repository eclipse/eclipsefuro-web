const e=e=>class extends e{constructor(){super(),this.__FBPEventlistener=[],this.__wirebundle={},this.__wireQueue=[]}firstUpdated(){this.__fbpAppended||(this._appendFBP(this.shadowRoot),this.__fbpAppended=!0),super.firstUpdated()}_FBPTriggerWire(e,t){this.__fbp_ready?this.__wirebundle[e]&&this.__wirebundle[e].forEach((e=>{if("function"==typeof e)e(t);else if("function"==typeof e.element[e.method]){let s;if(Array.isArray(t)&&e.element[e.method].length>1)s=e.element[e.method].apply(e.element,t);else{let n=t;e.path&&(n=this._pathGet(t,e.path)),s=e.element[e.method](n)}const n=new Event(`ƒ-${e.attrName}`,{composed:!1,bubbles:!1});n.detail=s,e.element.dispatchEvent(n)}else if(e.property){let s=t;e.path&&(s=this._pathGet(t,e.path)),e.element[e.property]=s}else console.warn(`${e.method} is neither a listener nor a function of ${e.element.nodeName}`,e.element)})):this.__enqueueTrigger(e,t)}_FBPAddWireHook(e,t,s){if(s=s||!1,this.__wirebundle[e]){if(s)return this.__wirebundle[e].unshift(t),0;return this.__wirebundle[e].push(t)-1}return this.__wirebundle[e]=[t],1}_FBPTraceWires(){const e=this;for(const t in this.__wirebundle)this._FBPAddWireHook(t,(s=>{const n=navigator.userAgent.toLowerCase();let r=!0;-1!==n.indexOf("safari")&&(r=n.indexOf("chrome")>-1),r&&(console.groupCollapsed("Trace for",`${this.nodeName}: ${t}`),console.table([{host:e,wire:t,data:s}]),console.groupCollapsed("Data"),console.log(s),console.groupEnd(),console.groupCollapsed("Target Elements"),console.table(e.__wirebundle[t]),console.groupEnd(),console.groupCollapsed("Call Stack"),console.log((new Error).stack),console.groupEnd(),console.groupEnd())}),!0)}_FBPDebug(e,t){const s=this;this._FBPAddWireHook(e,(n=>{if(t);else{const t=navigator.userAgent.toLowerCase();let r=!0;-1!==t.indexOf("safari")&&(r=t.indexOf("chrome")>-1),r&&(console.group("Debug",`${this.nodeName}: ${e}`),console.group("Target Elements"),console.table(s.__wirebundle[e]),console.groupEnd(),console.groupCollapsed("Data"),console.log(n),console.groupEnd(),console.groupCollapsed("Call Stack"),console.log((new Error).stack),console.groupEnd(),console.groupEnd())}}),!0)}__toCamelCase(e){return e.replace(/-([a-z])/g,(e=>e[1].toUpperCase()))}_appendFBP(e){const t=this,s=this.__wirebundle,n=e.querySelectorAll("*");for(let e=n.length-1;e>=0;--e){let t=n[e];if("TEMPLATE"===t.tagName&&"flow-repeat"===t.getAttribute("is")){const e=t,s=document.createElement("flow-repeat"),n=e.attributes.length;for(let t=0;t<n;++t){const{nodeName:n}=e.attributes.item(t),{nodeValue:r}=e.attributes.item(t);s.setAttribute(n,r)}const r=document.createElement("template");r.content.append(e.content),s.appendChild(r),e.parentNode.replaceChild(s,e),t=s}for(let e=0;e<t.attributes.length;e+=1)if(t.attributes[e].name.startsWith("ƒ-."))t.attributes[e].value.split(",").forEach((n=>{const r=this.__resolveWireAndPath(n);s[r.receivingWire]||(s[r.receivingWire]=[]),s[r.receivingWire].push({element:t,property:this.__toCamelCase(t.attributes[e].name.substr(3)),path:r.path})}));else if(t.attributes[e].name.startsWith("ƒ-"))t.attributes[e].value.split(",").forEach((n=>{const r=this.__resolveWireAndPath(n);s[r.receivingWire]||(s[r.receivingWire]=[]),s[r.receivingWire].push({element:t,method:this.__toCamelCase(t.attributes[e].name.substr(2)),attrName:t.attributes[e].name.substr(2),path:r.path})}));else if(t.attributes[e].name.startsWith("@-")){const s=t.attributes[e].name.substr(2);let n;t.attributes[e].value.split(",").forEach((e=>{const i=e.trim();let o="call";i.startsWith("((")?(n=i.substring(2,i.length-2),o="setValue"):i.startsWith("-^")?(n=i.substring(2),o="fireOnHost"):i.startsWith("^")?(n=i.substring(1),o="fire",i.startsWith("^^")&&(n=i.substring(2),o="fireBubble")):":STOP"===i?(o="stop",n="stop"):":PREVENTDEFAULT"===i?(o="preventdefault",n="preventdefault"):(n=i,o="call"),r(s,o,n,t)}))}else;}function r(e,s,n,r){r.__atf={};const i=n.match(/([a-z0-9\-_*\.]+)/gi);for(let e=0;e<r.attributes.length;e+=1)r.__atf[r.attributes[e].name]=!0;const o={stop(e){e.stopPropagation()},preventdefault(e){e.preventDefault()},call(e){let s=n,r=e.detail;null!==i&&i.length>1&&(r=i[1].startsWith("*")?1===i[1].length?e:t._pathGet(e,i[1].substr(2,i[1].length)):t._pathGet(t,i[1]),s=i[0]),t._FBPTriggerWire(s,r)},fire(e){if(null!==i&&i.length>1){const s=i[1],n=i[0],r=new Event(n,{composed:!1,bubbles:!0});s.startsWith("*")?r.detail=t._pathGet(e.detail,s.substr(2)):r.detail=t._pathGet(t,s),e.currentTarget.dispatchEvent(r)}else{const t=new Event(n,{composed:!1,bubbles:!0});t.detail=e.detail,e.currentTarget.dispatchEvent(t)}},fireOnHost(e){if(null!==i&&i.length>1){const s=i[1],n=i[0],r=new Event(n,{composed:!1,bubbles:!0});s.startsWith("*")?r.detail=t._pathGet(e.detail,s.substr(2)):r.detail=t._pathGet(t,s),t.dispatchEvent(r)}else{const s=new Event(n,{composed:!1,bubbles:!0});s.detail=e.detail,t.dispatchEvent(s)}},fireBubble(e){if(null!==i&&i.length>1){const s=i[1],n=i[0],r=new Event(n,{composed:!0,bubbles:!0});s.startsWith("*")?r.detail=t._pathGet(e.detail,s.substr(2)):r.detail=t._pathGet(t,s),e.currentTarget.dispatchEvent(r)}else{const t=new Event(n,{composed:!0,bubbles:!0});t.detail=e.detail,e.currentTarget.dispatchEvent(t)}},setValue(e){t._pathSet(t,n,e.detail)}};r.addEventListener(e,o[s]),t.__FBPEventlistener.push({element:r,event:e,handler:o[s]})}if(!this.__fbp_ready){this._FBPReady();const e=this.__wireQueue.length;for(let t=0;t<e;t+=1){const e=this.__wireQueue.shift();this._FBPTriggerWire(e.w,e.d)}}}_FBPReady(){this.__fbp_ready=!0,this._FBPTriggerWire("--FBPready")}__enqueueTrigger(e,t){this.__wireQueue.push({w:e,d:t})}__resolveWireAndPath(e){const t=e.trim().match(/(^[^\(]*)\(?\*?\.?([^\)]*)/);return{receivingWire:t[1],path:t[2]}}disconnectedCallback(){this.__wirebundle={},this.__wireQueue=[],this.__FBPEventlistener.forEach((e=>{e.element.removeEventListener(e.event,e.handler)})),super.disconnectedCallback&&super.disconnectedCallback()}_pathGet(e,t){let s=e;const n=this._split(t);for(let e=0;e<n.length;e+=1){if(!s)return!1;s=s[n[e]]}return s}_pathSet(e,t,s){let n=e;const r=this._split(t),i=r[r.length-1];if(r.length>1){for(let e=0;e<r.length-1;e+=1){if(n=n[r[e]],!n)return!1}n[i]=s}else n[t]=s;return r.join(".")}_split(e){return e.toString().split(".")}};class t extends(e(HTMLElement)){constructor(){super();const t=this.querySelector("template"),s=this.getAttribute("expose");let n=[];null!==s&&(n=s.split(","));class r extends(e(HTMLElement)){constructor(){super(),n.forEach((e=>{this[e]=t=>{this._FBPTriggerWire(`|--${e}`,t)}})),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t.content.cloneNode(!0)),this._appendFBP(this.shadowRoot)}}const i=this.getAttribute("name");window.customElements.define(i,r)}}window.customElements.define("furo-fbp",t);
